-- ServerInfo LocalScript
-- Đặt script này trong StarterGui -> ScreenGui
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local gui = script.Parent -- giả định script nằm trực tiếp dưới ScreenGui
if not gui:IsA("ScreenGui") then
    warn("LocalScript nên nằm trực tiếp trong ScreenGui")
end

-- ====== CẤU HÌNH: chỉnh vùng đảo ở đây ======
-- islandRegions: bảng gồm {name = "Tên đảo", min = Vector3, max = Vector3}
-- Các vùng đơn giản theo AABB (axis-aligned bounding box). Chỉnh lại theo map server của bạn.
local islandRegions = {
    { name = "Đảo Trung Tâm", min = Vector3.new(-200, -100, -200), max = Vector3.new(200, 500, 200) },
    { name = "Đảo Bắc",      min = Vector3.new(-800, -100, -200), max = Vector3.new(-201, 500, 200) },
    { name = "Đảo Nam",      min = Vector3.new(201, -100, -200),  max = Vector3.new(800, 500, 200) },
    -- Thêm đảo khác ở đây...
}
-- ===========================================

-- ====== Tạo UI nếu bạn chưa có các phần tử ======
-- Nếu bạn đã tạo UI trong Studio, bạn có thể bỏ phần tạo tự động và dùng UI đó.
local function makeUI()
    -- ScreenGui đã có (script.Parent)
    -- Tạo frame menu
    local frame = Instance.new("Frame")
    frame.Name = "ServerInfoFrame"
    frame.Size = UDim2.new(0, 250, 0, 120)
    frame.Position = UDim2.new(0, 12, 0, 12)
    frame.AnchorPoint = Vector2.new(0,0)
    frame.BackgroundTransparency = 0.07
    frame.BackgroundColor3 = Color3.fromRGB(20,20,25)
    frame.BorderSizePixel = 0
    frame.Parent = gui

    -- Header (tên)
    local header = Instance.new("TextLabel")
    header.Name = "Header"
    header.Size = UDim2.new(1, -44, 0, 36)
    header.Position = UDim2.new(0, 8, 0, 8)
    header.BackgroundTransparency = 1
    header.Font = Enum.Font.GothamBold
    header.TextSize = 18
    header.TextXAlignment = Enum.TextXAlignment.Left
    header.TextYAlignment = Enum.TextYAlignment.Center
    header.TextColor3 = Color3.fromRGB(230,230,230)
    header.Text = "Server Info"
    header.Parent = frame

    -- Toggle button
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Name = "Toggle"
    toggleBtn.Size = UDim2.new(0, 28, 0, 28)
    toggleBtn.Position = UDim2.new(1, -36, 0, 8)
    toggleBtn.AnchorPoint = Vector2.new(0,0)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(40,40,50)
    toggleBtn.BorderSizePixel = 0
    toggleBtn.Font = Enum.Font.GothamSemibold
    toggleBtn.TextSize = 18
    toggleBtn.Text = "≡"
    toggleBtn.TextColor3 = Color3.fromRGB(230,230,230)
    toggleBtn.Parent = frame

    -- Info labels container
    local infoContainer = Instance.new("Frame")
    infoContainer.Name = "Info"
    infoContainer.Size = UDim2.new(1, -16, 0, 68)
    infoContainer.Position = UDim2.new(0, 8, 0, 44)
    infoContainer.BackgroundTransparency = 1
    infoContainer.Parent = frame

    local label1 = Instance.new("TextLabel")
    label1.Name = "PlayerName"
    label1.Size = UDim2.new(1, 0, 0, 20)
    label1.Position = UDim2.new(0, 0, 0, 0)
    label1.BackgroundTransparency = 1
    label1.Font = Enum.Font.Gotham
    label1.TextSize = 14
    label1.TextXAlignment = Enum.TextXAlignment.Left
    label1.TextColor3 = Color3.fromRGB(220,220,220)
    label1.Text = "Name: -"
    label1.Parent = infoContainer

    local label2 = Instance.new("TextLabel")
    label2.Name = "UserId"
    label2.Size = UDim2.new(1, 0, 0, 20)
    label2.Position = UDim2.new(0, 0, 0, 22)
    label2.BackgroundTransparency = 1
    label2.Font = Enum.Font.Gotham
    label2.TextSize = 14
    label2.TextXAlignment = Enum.TextXAlignment.Left
    label2.TextColor3 = Color3.fromRGB(220,220,220)
    label2.Text = "UserId: -"
    label2.Parent = infoContainer

    local label3 = Instance.new("TextLabel")
    label3.Name = "Island"
    label3.Size = UDim2.new(1, 0, 0, 20)
    label3.Position = UDim2.new(0, 0, 0, 44)
    label3.BackgroundTransparency = 1
    label3.Font = Enum.Font.Gotham
    label3.TextSize = 14
    label3.TextXAlignment = Enum.TextXAlignment.Left
    label3.TextColor3 = Color3.fromRGB(220,220,220)
    label3.Text = "Island: -"
    label3.Parent = infoContainer

    -- Khởi trạng thái ẩn nhẹ (thu nhỏ)
    frame.AnchorPoint = Vector2.new(0, 0)
    return frame, toggleBtn, label1, label2, label3
end

-- Nếu bạn đã tự thêm phần tử UI vào ScreenGui trong Studio, bỏ qua makeUI
local frame, toggleBtn, nameLabel, idLabel, islandLabel
if gui:FindFirstChild("ServerInfoFrame") then
    frame = gui.ServerInfoFrame
    toggleBtn = frame:FindFirstChild("Toggle")
    nameLabel = frame:FindFirstChild("Info") and frame.Info:FindFirstChild("PlayerName")
    idLabel = frame:FindFirstChild("Info") and frame.Info:FindFirstChild("UserId")
    islandLabel = frame:FindFirstChild("Info") and frame.Info:FindFirstChild("Island")
else
    frame, toggleBtn, nameLabel, idLabel, islandLabel = makeUI()
end

-- ====== Tween settings cho mở/đóng mượt ======
local openPos = frame.Position
local closedPos = UDim2.new(openPos.X.Scale, openPos.X.Offset - (frame.Size.X.Offset - 36), openPos.Y.Scale, openPos.Y.Offset) -- kéo sang trái chỉ còn nút
local tweenInfo = TweenInfo.new(0.28, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local isOpen = true

local openTween = TweenService:Create(frame, tweenInfo, {Position = openPos})
local closeTween = TweenService:Create(frame, tweenInfo, {Position = closedPos})

-- Toggle function
local function toggle()
    if isOpen then
        closeTween:Play()
    else
        openTween:Play()
    end
    isOpen = not isOpen
end

toggleBtn.MouseButton1Click:Connect(toggle)

-- ====== Hàm xác định đảo dựa trên vị trí ======
local function getIslandFromPosition(pos)
    for _, region in ipairs(islandRegions) do
        local minb = region.min
        local maxb = region.max
        if pos.X >= minb.X and pos.X <= maxb.X
        and pos.Y >= minb.Y and pos.Y <= maxb.Y
        and pos.Z >= minb.Z and pos.Z <= maxb.Z then
            return region.name
        end
    end
    return "Không xác định"
end

-- ====== Cập nhật thông tin hiển thị ======
local function updateInfo()
    if not player then return end
    nameLabel.Text = "Name: " .. tostring(player.Name or "-")
    idLabel.Text = "UserId: " .. tostring(player.UserId or "-")

    local char = player.Character
    local hrp = char and (char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso"))
    if hrp and hrp:IsA("BasePart") then
        local island = getIslandFromPosition(hrp.Position)
        islandLabel.Text = "Island: " .. island
    else
        islandLabel.Text = "Island: -"
    end
end

-- Cập nhật định kỳ mượt (nửa giây); bạn có thể điều chỉnh
local updateInterval = 0.5
spawn(function()
    while true do
        local start = tick()
        updateInfo()
        local elapsed = tick() - start
        local waitTime = updateInterval - elapsed
        if waitTime > 0 then
            wait(waitTime)
        else
            -- nếu bị trễ thì tiếp liền
            RunService.Heartbeat:Wait()
        end
    end
end)

-- Cập nhật khi respawn / character add
player.CharacterAdded:Connect(function()
    wait(0.2) -- đợi HRP spawn
    updateInfo()
end)

-- Khởi tạo trạng thái ban đầu: ẩn/hiện theo isOpen (mặc định true)
frame.Position = openPos

-- Ghi chú: có thể mở rộng hiển thị thêm ping, server tick, team, vị trí toạ độ, v.v.
-- Lưu ý: chỉnh islandRegions cho khớp toạ độ thực tế server của bạn.
